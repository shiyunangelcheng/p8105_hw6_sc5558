p8105_hw6_sc5558
================
Shiyun Angel Cheng
2025-12-02

Import Necessary Libraries

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.2     ✔ tibble    3.3.0
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.1.0     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(broom)
library(p8105.datasets)
```

## Problem 1

``` r
#Load and Clean Data
homicides = read_csv("homicide-data.csv") |>
  mutate(
    city_state = str_c(city, ", ", state),
    solved = case_when(
      disposition == "Closed by arrest" ~ 1,
      TRUE ~ 0
    ),
    victim_age = as.numeric(victim_age)
  ) |>
  filter(
    !(city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO")),
    city_state != "Tulsa, AL",
    victim_race %in% c("White", "Black")
  )
```

    ## Rows: 52179 Columns: 12
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

    ## Warning: There was 1 warning in `mutate()`.
    ## ℹ In argument: `victim_age = as.numeric(victim_age)`.
    ## Caused by warning:
    ## ! NAs introduced by coercion

Logistic Regression - Baltimore, MD

``` r
baltimore_df = homicides |> filter(city_state == "Baltimore, MD")

baltimore_fit = glm(
  solved ~ victim_age + victim_sex + victim_race,
  family = binomial,
  data = baltimore_df
)

baltimore_results =
  tidy(baltimore_fit, conf.int = TRUE, exponentiate = TRUE)

baltimore_results
```

    ## # A tibble: 4 × 7
    ##   term             estimate std.error statistic  p.value conf.low conf.high
    ##   <chr>               <dbl>     <dbl>     <dbl>    <dbl>    <dbl>     <dbl>
    ## 1 (Intercept)         1.36    0.171        1.81 7.04e- 2    0.976     1.91 
    ## 2 victim_age          0.993   0.00332     -2.02 4.30e- 2    0.987     1.000
    ## 3 victim_sexMale      0.426   0.138       -6.18 6.26e-10    0.324     0.558
    ## 4 victim_raceWhite    2.32    0.175        4.82 1.45e- 6    1.65      3.28

Extract adjusted OR

``` r
baltimore_or =
  baltimore_results |> 
  filter(term == "victim_sexMale") |> 
  select(estimate, conf.low, conf.high)
```

Fit Models for ALL Cities

``` r
city_results = 
  homicides |>
  group_by(city_state) |>
  nest() |>
  mutate(
    model = map(data, ~ glm(
      solved ~ victim_age + victim_sex + victim_race,
      family = binomial,
      data = .x
    )),
    tidy_model = map(model, ~ tidy(.x, conf.int = TRUE, exponentiate = TRUE))
  ) |>
  unnest(tidy_model) |>
  filter(term == "victim_sexMale")
```

    ## Warning: There were 43 warnings in `mutate()`.
    ## The first warning was:
    ## ℹ In argument: `tidy_model = map(model, ~tidy(.x, conf.int = TRUE, exponentiate
    ##   = TRUE))`.
    ## ℹ In group 1: `city_state = "Albuquerque, NM"`.
    ## Caused by warning:
    ## ! glm.fit: fitted probabilities numerically 0 or 1 occurred
    ## ℹ Run `dplyr::last_dplyr_warnings()` to see the 42 remaining warnings.

Plot Adjusted ORs by City

``` r
city_results |>
  mutate(city_state = fct_reorder(city_state, estimate)) |>
  ggplot(aes(x = estimate, y = city_state)) +
  geom_point() +
  geom_errorbar(aes(xmin = conf.low, xmax = conf.high), width = 0.2) +
  geom_vline(xintercept = 1, linetype = "dashed") +
  labs(
    x = "Adjusted Odds Ratio (male vs female)",
    y = "City",
    title = "Adjusted OR for Male vs Female Victims — Homicide Solved Probability"
  )
```

![](p8105_hw6_sc5558_files/figure-gfm/unnamed-chunk-6-1.png)<!-- -->
Text Comment: Cities vary widely in the adjusted odds of a homicide
being solved for male versus female victims. Several cities have OR
estimates above 1, indicating that homicides of male victims are more
likely to be solved relative to female victims, while others have ORs
below 1, showing the opposite pattern. Confidence intervals are often
wide, reflecting small sample sizes. Cities with narrower CIs tend to
have larger homicide counts and more stable estimates. \## Problem 2

You can also embed plots, for example:

``` r
data("weather_df")

weather_df = 
  weather_df |>
  drop_na(tmax, tmin, prcp)
```

Note that the `echo = FALSE` parameter was added to the code chunk to
prevent printing of the R code that generated the plot.
